# BAC4 v1.0.0 - Timeline Tracking (Complete Specification)

**Feature:** Timeline-based Architecture Evolution Tracking
**Version:** 1.0.0 (Breaking Change)
**Status:** âœ… Approved - Ready for Implementation
**Focus Use Case:** Architecture Decision Records (ADR) with Visual Diffs

---

## âš ï¸ Breaking Change Notice

**This is a major version bump (v0.8.0 â†’ v1.0.0) with a breaking file format change.**

**What This Means:**
- Existing .bac4 files from v0.8.0 and earlier **will NOT open** in v1.0.0
- Users will need to recreate diagrams or use optional migration tool
- **No backward compatibility** - simpler, cleaner implementation

**Why This Decision:**
- âœ… Cleaner architecture (no compatibility layer)
- âœ… Faster implementation (6 weeks vs 7 weeks)
- âœ… No technical debt from legacy format support
- âœ… Better foundation for future features
- âœ… Simpler codebase for future contributors

**Migration Path:**
- Users can stay on v0.8.0 if needed
- Export old diagrams as PNG/SVG for reference
- Recreate in v1.0.0 (usually faster than expected)
- Optional one-way migration tool (Phase 8, if users request)

---

## ğŸ“‹ Table of Contents

1. [Executive Summary](#executive-summary)
2. [User Stories](#user-stories)
3. [Feature Requirements](#feature-requirements)
4. [Technical Specification](#technical-specification)
5. [File Format Design (v1.0.0)](#file-format-design-v100)
6. [UI/UX Design](#uiux-design)
7. [Implementation Phases (6 Weeks)](#implementation-phases-6-weeks)
8. [Testing Strategy](#testing-strategy)
9. [Documentation Plan](#documentation-plan)
10. [Success Metrics](#success-metrics)

---

## ğŸ¯ Executive Summary

### The Problem

Solution architects face a critical challenge: **tracking architectural evolution over time**. When proposing changes, they need to:
- Visualize "before" and "after" states
- Document why changes were made (ADRs)
- Show implementation progress vs. original plan
- Track architectural drift

**Current Pain Points:**
- Duplicate diagrams for each state (maintenance nightmare)
- No visual diff between states
- ADRs describe changes in text, but lack visual clarity
- Hard to compare "planned" vs "actual" architecture

### The Solution

**Timeline-based diagram versioning** that enables:
1. **Multiple snapshots** in a single diagram file
2. **Visual change indicators** (new, modified, removed)
3. **Annotation tools** to explain changes
4. **Time navigation** to move between states
5. **ADR integration** - link diagrams to decision records

### Primary Use Case: Architecture Decision Records (ADRs)

```
Workflow:
1. Architect creates ADR for proposed change
2. Opens diagram, adds "Before" and "After" snapshots
3. Marks changes with visual indicators (green/yellow/red badges)
4. Adds annotations explaining rationale
5. Exports both states to embed in ADR document
6. Links diagram to ADR markdown file
```

**Example:** "ADR-005: Migrate from Monolith to Microservices"
- **Before** snapshot shows monolithic architecture
- **After** snapshot shows microservices with new components (green badges)
- Annotations explain decomposition strategy
- Both diagrams embedded in ADR markdown

---

## ğŸ‘¤ User Stories

### Primary: Architecture Decision Records

**As a solution architect,**
**When I create an Architecture Decision Record (ADR),**
**I want to create "Before" and "After" diagram snapshots,**
**So that stakeholders can visually understand the proposed change.**

**Acceptance Criteria:**
- Can create multiple timeline snapshots in one diagram
- Can switch between snapshots with simple UI
- Can annotate what's changing and why
- Can export both snapshots with descriptive filenames
- Can link diagram to ADR markdown file

### Secondary: Planning Future Architecture

**As a solution architect,**
**When planning future architecture phases,**
**I want to show how the system will evolve over time,**
**So that the roadmap is visually clear.**

**Acceptance Criteria:**
- Can create snapshots for each phase (Q1, Q2, Q3, etc.)
- Can navigate timeline forward/backward
- Can show what's new, modified, or deprecated in each phase
- Can export all phases for presentations

### Tertiary: Tracking Implementation Progress

**As a solution architect,**
**When tracking implementation progress,**
**I want to compare "Planned" vs "Actual" architecture,**
**So that I can identify architectural drift.**

**Acceptance Criteria:**
- Can create "Planned" baseline snapshot
- Can update "Actual" snapshot as implementation progresses
- Can visually compare the two states
- Can identify unplanned changes

---

## âœ… Feature Requirements

### Functional Requirements

#### FR-1: Timeline Management

**FR-1.1: Create Snapshots**
- User can create named timeline snapshots (e.g., "Before", "After", "Q2 2025")
- Each snapshot has: ID, label, timestamp (optional), description (optional)
- First snapshot created automatically ("Current") when creating new diagram
- Maximum 10 snapshots per diagram (reasonable limit for UX)

**FR-1.2: Navigate Snapshots**
- Previous/Next buttons to navigate timeline
- Dropdown to jump to any snapshot
- Keyboard shortcuts: Cmd+[ (previous), Cmd+] (next)
- Current snapshot displayed prominently in toolbar

**FR-1.3: Edit Snapshots**
- Rename snapshot (double-click label)
- Delete snapshot (with confirmation)
- Reorder snapshots (drag-and-drop in timeline manager)
- Set snapshot description (for context)

**FR-1.4: Snapshot Metadata**
- Each snapshot stores: label, timestamp, description
- Timestamps can be explicit dates or relative ("Q2 2025", "Phase 1")
- Hybrid model: Named milestones + optional dates

#### FR-2: Change Indicators

**FR-2.1: Automatic Change Detection**
- System detects nodes added/removed between snapshots
- System detects nodes modified (label, color, position changes)
- Visual badges applied automatically:
  - ğŸŸ¢ Green = New in this snapshot
  - ğŸŸ¡ Yellow = Modified in this snapshot
  - ğŸ”´ Red = Removed/deprecated in this snapshot
  - âšª No badge = Unchanged

**FR-2.2: Manual Change Markers**
- User can override automatic detection
- User can mark node as "new", "modified", "removed" manually
- User can add change notes to nodes ("Replaced by System X")

**FR-2.3: Edge Change Indicators**
- Edges also get change indicators (new, modified, removed)
- Visual: Dashed lines for deprecated, solid for new
- Color coding: Green (new), red (deprecated), gray (unchanged)

#### FR-3: Annotation System

**FR-3.1: Annotation Types**
- **Text Box:** Free-form notes anywhere on canvas
- **Callout:** Arrow pointing to node with explanation
- **Change Badge:** Structured annotation (ğŸ†• New, ğŸ”„ Modified, âš ï¸ Deprecated, ğŸ—‘ï¸ To Remove)
- **Highlight:** Circle/rectangle to draw attention to region

**FR-3.2: Annotation Palette**
- New palette for Context and Container diagrams (matches Component Palette UX)
- Drag-and-drop annotations onto canvas
- Annotations tied to specific snapshot (appear/disappear with timeline)

**FR-3.3: Annotation Properties**
- Editable text, color, position, size
- Can link annotation to specific node (follows node if moved)
- Can set visibility per snapshot (show in "Before" but not "After")

#### FR-4: Export Enhancements

**FR-4.1: Filename with Timeline**
- Export filename includes snapshot label
- Pattern: `{diagram-name}_{snapshot-label}.png`
- Example: `Payment_System_Before.png`, `Payment_System_After.png`
- User can customize pattern in settings

**FR-4.2: Single Export**
- Exports current snapshot only
- Includes annotations and change indicators
- Maintains existing export quality (PNG/JPEG/SVG)

**FR-4.3: Batch Export** (Future: v1.1.0)
- "Export All Snapshots" button
- Creates multiple files (one per snapshot)
- Exports to same folder with timeline labels

**FR-4.4: Comparison Export** (Future: v1.1.0)
- Side-by-side "Before" vs "After"
- Visual diff highlighting
- Larger canvas for side-by-side view

#### FR-5: ADR Integration

**FR-5.1: Link to ADR Markdown**
- Node properties include "ADR Link" field
- Links to specific ADR markdown file in vault
- Opens ADR when clicking link in Property Panel

**FR-5.2: Embed Diagrams in ADR**
- Automatic markdown generation for ADR template
- Includes both "Before" and "After" diagram exports
- Template structure:
  ```markdown
  ## Context

  ### Current Architecture (Before)
  ![[Payment_System_Before.png]]

  ### Proposed Architecture (After)
  ![[Payment_System_After.png]]

  ## Decision
  ...
  ```

**FR-5.3: ADR Change Summary**
- Generate bullet list of changes between snapshots
- Example:
  ```
  **Changes:**
  - Added: API Gateway (new component)
  - Modified: User Service (split into Auth Service + Profile Service)
  - Removed: Monolithic Backend
  ```

### Non-Functional Requirements

#### NFR-1: Performance
- Switching snapshots: <100ms (instant feel)
- Loading diagram with 10 snapshots: <1s
- Export with annotations: <3s
- File size increase: <20% per additional snapshot

#### NFR-2: Usability
- Timeline navigation intuitive (no learning curve)
- Annotations easy to add (drag-and-drop)
- Change indicators clear and unobtrusive

#### NFR-3: Compatibility
- **Breaking change:** No backward compatibility with v0.8.0
- v1.0.0 is the only supported format
- Clean, simple file format

#### NFR-4: Maintainability
- Service layer for timeline management
- Separate annotation rendering from node rendering
- TypeScript strict mode compliance
- 80%+ test coverage on new code

---

## ğŸ”§ Technical Specification

### Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BAC4 Plugin (v1.0.0)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  UI Layer                                                    â”‚
â”‚  â”œâ”€â”€ TimelineToolbar.tsx          (NEW)                     â”‚
â”‚  â”œâ”€â”€ AnnotationPalette.tsx        (NEW)                     â”‚
â”‚  â”œâ”€â”€ SnapshotManager.tsx          (NEW)                     â”‚
â”‚  â””â”€â”€ canvas-view.tsx               (MODIFIED)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Service Layer                                               â”‚
â”‚  â”œâ”€â”€ TimelineService.ts           (NEW)                     â”‚
â”‚  â”œâ”€â”€ AnnotationService.ts         (NEW)                     â”‚
â”‚  â”œâ”€â”€ ChangeDetectionService.ts    (NEW)                     â”‚
â”‚  â””â”€â”€ ADRIntegrationService.ts     (NEW)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Data Layer                                                  â”‚
â”‚  â”œâ”€â”€ file-io.ts                   (MODIFIED)                â”‚
â”‚  â””â”€â”€ bac4-file-format-v1.0.0.ts   (NEW)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Existing Infrastructure                                     â”‚
â”‚  â”œâ”€â”€ React Flow                   (canvas rendering)         â”‚
â”‚  â”œâ”€â”€ MarkdownLinkService          (existing)                â”‚
â”‚  â””â”€â”€ DiagramNavigationService     (existing)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### New Components

#### 1. TimelineToolbar.tsx

**Purpose:** UI for timeline navigation and snapshot management

**Props:**
```typescript
interface TimelineToolbarProps {
  snapshots: TimelineSnapshot[];
  currentSnapshotId: string;
  onSnapshotChange: (snapshotId: string) => void;
  onCreateSnapshot: (label: string) => void;
  onDeleteSnapshot: (snapshotId: string) => void;
  onRenameSnapshot: (snapshotId: string, newLabel: string) => void;
}
```

**UI Elements:**
- Previous/Next buttons (â—€ â–¶)
- Snapshot dropdown (with labels)
- Add Snapshot button (+)
- Snapshot Manager button (âš™ï¸)

**Location:** Below main toolbar, above canvas

#### 2. AnnotationPalette.tsx

**Purpose:** Drag-and-drop palette for annotations (Context/Container diagrams)

**Props:**
```typescript
interface AnnotationPaletteProps {
  visible: boolean;
  diagramType: 'context' | 'container' | 'component';
  onAnnotationDrop: (type: AnnotationType, position: XYPosition) => void;
}
```

**Annotation Types:**
```typescript
type AnnotationType =
  | 'text-box'
  | 'callout'
  | 'badge-new'
  | 'badge-modified'
  | 'badge-deprecated'
  | 'badge-remove'
  | 'highlight-circle'
  | 'highlight-rect';
```

**UI Design:** Similar to ComponentPalette (moveable, resizable)

#### 3. SnapshotManager.tsx

**Purpose:** Modal for managing all snapshots (rename, delete, reorder, add descriptions)

**Props:**
```typescript
interface SnapshotManagerProps {
  snapshots: TimelineSnapshot[];
  currentSnapshotId: string;
  onClose: () => void;
  onUpdateSnapshots: (snapshots: TimelineSnapshot[]) => void;
}
```

**Features:**
- List all snapshots with metadata
- Drag to reorder
- Edit labels and descriptions
- Delete with confirmation
- Set timestamps

#### 4. TimelineService.ts

**Purpose:** Business logic for timeline operations

**Methods:**
```typescript
class TimelineService {
  /**
   * Create a new snapshot from current canvas state
   */
  static createSnapshot(
    label: string,
    nodes: Node[],
    edges: Edge[],
    annotations: Annotation[],
    timestamp?: string,
    description?: string
  ): TimelineSnapshot;

  /**
   * Switch to a different snapshot (load state)
   */
  static switchSnapshot(
    snapshotId: string,
    timeline: Timeline
  ): { nodes: Node[]; edges: Edge[]; annotations: Annotation[] };

  /**
   * Delete a snapshot
   */
  static deleteSnapshot(
    snapshotId: string,
    timeline: Timeline
  ): Timeline;

  /**
   * Rename a snapshot
   */
  static renameSnapshot(
    snapshotId: string,
    newLabel: string,
    timeline: Timeline
  ): Timeline;

  /**
   * Reorder snapshots
   */
  static reorderSnapshots(
    newOrder: string[],
    timeline: Timeline
  ): Timeline;

  /**
   * Get next/previous snapshot in timeline
   */
  static getNextSnapshot(currentId: string, timeline: Timeline): TimelineSnapshot | null;
  static getPreviousSnapshot(currentId: string, timeline: Timeline): TimelineSnapshot | null;
}
```

#### 5. AnnotationService.ts

**Purpose:** Business logic for annotation management

**Methods:**
```typescript
class AnnotationService {
  /**
   * Create a new annotation
   */
  static createAnnotation(
    type: AnnotationType,
    position: XYPosition,
    snapshotId: string,
    properties?: Partial<AnnotationProperties>
  ): Annotation;

  /**
   * Update annotation properties
   */
  static updateAnnotation(
    annotationId: string,
    updates: Partial<AnnotationProperties>
  ): Annotation;

  /**
   * Delete annotation
   */
  static deleteAnnotation(annotationId: string): void;

  /**
   * Get annotations for specific snapshot
   */
  static getAnnotationsForSnapshot(
    snapshotId: string,
    allAnnotations: Annotation[]
  ): Annotation[];

  /**
   * Link annotation to node (follows node movement)
   */
  static linkAnnotationToNode(
    annotationId: string,
    nodeId: string
  ): Annotation;
}
```

#### 6. ChangeDetectionService.ts

**Purpose:** Detect changes between snapshots

**Methods:**
```typescript
class ChangeDetectionService {
  /**
   * Compare two snapshots and identify changes
   */
  static detectChanges(
    previousSnapshot: TimelineSnapshot,
    currentSnapshot: TimelineSnapshot
  ): ChangeSet;

  /**
   * Apply change indicators to nodes/edges
   */
  static applyChangeIndicators(
    nodes: Node[],
    edges: Edge[],
    changeSet: ChangeSet
  ): { nodes: Node[]; edges: Edge[] };

  /**
   * Generate change summary text (for ADRs)
   */
  static generateChangeSummary(changeSet: ChangeSet): string;
}

interface ChangeSet {
  addedNodes: string[];      // Node IDs
  modifiedNodes: string[];   // Node IDs
  removedNodes: string[];    // Node IDs
  addedEdges: string[];      // Edge IDs
  removedEdges: string[];    // Edge IDs
}
```

#### 7. ADRIntegrationService.ts

**Purpose:** Link diagrams to ADR markdown files

**Methods:**
```typescript
class ADRIntegrationService {
  /**
   * Create ADR markdown with embedded diagram exports
   */
  static createADR(
    vault: Vault,
    adrPath: string,
    title: string,
    diagramPath: string,
    beforeSnapshotId: string,
    afterSnapshotId: string
  ): Promise<TFile>;

  /**
   * Link node to existing ADR
   */
  static linkNodeToADR(
    nodeId: string,
    adrPath: string
  ): void;

  /**
   * Export both "Before" and "After" diagrams for ADR
   */
  static exportADRDiagrams(
    diagramPath: string,
    beforeSnapshotId: string,
    afterSnapshotId: string
  ): Promise<{ beforeImage: string; afterImage: string }>;

  /**
   * Get ADR template with embedded diagrams
   */
  static getADRTemplate(
    title: string,
    beforeImage: string,
    afterImage: string,
    changeSummary: string
  ): string;
}
```

---

## ğŸ“ File Format Design (v1.0.0)

### v1.0.0 File Format (Only Format)

**This is the only file format BAC4 v1.0.0 supports - no backward compatibility.**

```json
{
  "version": "1.0.0",
  "metadata": {
    "diagramType": "context",
    "createdAt": "2024-10-15T10:00:00.000Z",
    "updatedAt": "2024-10-15T15:30:00.000Z"
  },
  "timeline": {
    "snapshots": [
      {
        "id": "snapshot-1",
        "label": "Before - Monolithic",
        "timestamp": "2024-10-15",
        "description": "Current monolithic architecture",
        "createdAt": "2024-10-15T10:00:00.000Z",
        "nodes": [
          {
            "id": "node-1",
            "type": "system",
            "position": { "x": 100, "y": 100 },
            "data": {
              "label": "Monolithic Backend",
              "color": "#4A90E2",
              "description": "Single monolithic application",
              "linkedDiagramPath": null,
              "linkedMarkdownPath": null,
              "adrLink": "ADRs/ADR-005-Microservices.md"
            }
          }
        ],
        "edges": [
          {
            "id": "edge-1",
            "source": "node-1",
            "target": "node-2",
            "type": "directional",
            "data": {
              "label": "uses",
              "direction": "right"
            }
          }
        ],
        "annotations": [
          {
            "id": "annotation-1",
            "type": "text-box",
            "position": { "x": 200, "y": 200 },
            "data": {
              "text": "Legacy monolithic architecture - to be decomposed",
              "color": "#FF6B6B",
              "fontSize": 12,
              "linkedNodeId": "node-1"
            }
          }
        ]
      },
      {
        "id": "snapshot-2",
        "label": "After - Microservices",
        "timestamp": "2025-06-01",
        "description": "Target microservices architecture",
        "createdAt": "2024-10-15T14:00:00.000Z",
        "nodes": [
          {
            "id": "node-2",
            "type": "system",
            "position": { "x": 100, "y": 100 },
            "data": {
              "label": "Auth Service",
              "color": "#51CF66",
              "description": "Handles authentication and authorization",
              "changeIndicator": "new",
              "linkedDiagramPath": null,
              "linkedMarkdownPath": null,
              "adrLink": "ADRs/ADR-005-Microservices.md"
            }
          },
          {
            "id": "node-3",
            "type": "system",
            "position": { "x": 300, "y": 100 },
            "data": {
              "label": "User Service",
              "color": "#51CF66",
              "description": "User profile management",
              "changeIndicator": "new",
              "linkedDiagramPath": null,
              "linkedMarkdownPath": null
            }
          }
        ],
        "edges": [
          {
            "id": "edge-2",
            "source": "node-2",
            "target": "node-3",
            "type": "directional",
            "data": {
              "label": "uses",
              "direction": "right",
              "changeIndicator": "new"
            }
          }
        ],
        "annotations": [
          {
            "id": "annotation-2",
            "type": "badge-new",
            "position": { "x": 150, "y": 80 },
            "data": {
              "text": "New microservices",
              "color": "#51CF66",
              "linkedNodeId": null
            }
          },
          {
            "id": "annotation-3",
            "type": "callout",
            "position": { "x": 400, "y": 200 },
            "data": {
              "text": "Decomposed from monolith - improves scalability",
              "color": "#4A90E2",
              "fontSize": 11,
              "linkedNodeId": "node-3"
            }
          }
        ]
      }
    ],
    "currentSnapshotId": "snapshot-1",
    "snapshotOrder": ["snapshot-1", "snapshot-2"]
  }
}
```

### Key Design Decisions

**1. Full Snapshots (Not Deltas)**
- **Rationale:** Simpler to implement, easier to debug, clearer data structure
- **Trade-off:** Larger file size (~20% increase per snapshot)
- **Future:** Can optimize to delta/diff format in v1.1.0 if needed

**2. Annotations Per Snapshot**
- **Rationale:** Annotations are specific to a timeline state (explain what's changing)
- **Benefit:** Switching snapshots shows/hides relevant annotations
- **Example:** "This is new in Q2" annotation only visible in Q2 snapshot

**3. Change Indicators in Node Data**
- **Rationale:** Visual badges need to persist with node
- **Options:** `"new"`, `"modified"`, `"removed"`, `null` (unchanged)
- **Benefit:** Automatic rendering of badges by node components

**4. Snapshot Order Array**
- **Rationale:** User can reorder snapshots (timeline isn't always chronological)
- **Example:** ["Current", "Future", "Phase 1", "Phase 2"] - "Future" before phases

**5. Current Snapshot ID**
- **Rationale:** Remember which snapshot user was viewing
- **Benefit:** Reload diagram to same state user left it

**6. Timeline Always Present**
- **Rationale:** Every v1.0.0 file has timeline structure (consistency)
- **Benefit:** No optional fields, simpler loading logic
- **New Diagrams:** Start with one snapshot ("Current")

---

## ğŸ¨ UI/UX Design

### Timeline Toolbar (NEW)

**Location:** Between main toolbar and canvas

**Layout:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â—€ [Before - Monolithic â–¼] â–¶ â”‚ [+ Add Snapshot] [âš™ï¸ Manage] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Components:**

1. **Previous Button (â—€)**
   - Navigate to previous snapshot
   - Disabled if at first snapshot
   - Keyboard: Cmd+[

2. **Snapshot Dropdown**
   - Shows current snapshot label
   - Click to open dropdown with all snapshots
   - Each item shows: label, timestamp (if set)
   - Current snapshot highlighted

3. **Next Button (â–¶)**
   - Navigate to next snapshot
   - Disabled if at last snapshot
   - Keyboard: Cmd+]

4. **Add Snapshot Button (+)**
   - Click to create new snapshot
   - Opens modal: "Create New Snapshot"
   - Fields: Label (required), Timestamp (optional), Description (optional)
   - Copies current canvas state to new snapshot

5. **Manage Button (âš™ï¸)**
   - Opens SnapshotManager modal
   - List all snapshots, edit metadata, reorder, delete

**Visibility:**
- Only visible when diagram has 2+ snapshots
- New diagrams (single snapshot) don't show timeline toolbar
- Fades in smoothly when second snapshot added

### Annotation Palette (NEW)

**Location:** Top-right (like ComponentPalette, but for Context/Container)

**Layout:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Annotations    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“ Text Box    â”‚
â”‚ ğŸ’¬ Callout     â”‚
â”‚ ğŸŸ¢ New Badge   â”‚
â”‚ ğŸŸ¡ Modified    â”‚
â”‚ ğŸ”´ Deprecated  â”‚
â”‚ ğŸ—‘ï¸ Remove      â”‚
â”‚ â­• Highlight   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Features:**
- Moveable (drag header)
- Resizable (drag corners)
- Collapsible (minimize to icon)
- Only shows for Context/Container diagrams (Component has cloud components)

**Drag-and-Drop:**
- Drag annotation type onto canvas
- Drop creates annotation at position
- Opens property editor immediately

### Snapshot Manager Modal (NEW)

**Purpose:** Manage all snapshots in one place

**Layout:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Manage Timeline Snapshots                     [âœ• Close]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  ğŸ“‹ Snapshot List                    [+ Add Snapshot]   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ â˜° Before - Monolithic                    [Edit][Ã—] â”‚â”‚
â”‚  â”‚   Created: 2024-10-15                               â”‚â”‚
â”‚  â”‚   Desc: Current monolithic architecture            â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ â˜° After - Microservices                  [Edit][Ã—] â”‚â”‚
â”‚  â”‚   Created: 2024-10-15                               â”‚â”‚
â”‚  â”‚   Desc: Target microservices architecture          â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                          â”‚
â”‚  ğŸ’¡ Drag to reorder â€¢ Click Edit to rename/update      â”‚
â”‚                                                          â”‚
â”‚                               [Cancel]  [Save Changes]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Features:**
- Drag handle (â˜°) to reorder snapshots
- Edit button opens inline editor (label, timestamp, description)
- Delete button (Ã—) with confirmation dialog
- Add Snapshot creates new snapshot from current state
- Save/Cancel to commit or discard changes

### Change Indicator Badges (NEW)

**Visual Design:**

**Node with "New" Indicator:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸŸ¢ Auth Serviceâ”‚ â† Green badge top-left
â”‚                 â”‚
â”‚  Handles auth   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Node with "Modified" Indicator:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸŸ¡ User Serviceâ”‚ â† Yellow badge top-left
â”‚                 â”‚
â”‚  Profile mgmt   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Node with "Removed" Indicator:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”´ Monolith    â”‚ â† Red badge top-left
â”‚                 â”‚   + Semi-transparent
â”‚  Legacy system  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Badge Positioning:**
- Top-left corner of node
- Emoji badges (ğŸŸ¢ ğŸŸ¡ ğŸ”´)
- Small, unobtrusive
- Optional: Hover shows change note

### Property Panel Updates

**New Section: "Timeline"**

Location: After "Linked Documentation" section

**Fields:**
- **Change Status:** Dropdown (None, New, Modified, Removed)
- **Change Note:** Text area (explain what changed)
- **ADR Link:** File picker (link to ADR markdown)
- **Open ADR:** Button (opens linked ADR)

**Example:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Timeline               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Change Status:         â”‚
â”‚ [New in this phase â–¼]  â”‚
â”‚                        â”‚
â”‚ Change Note:           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Decomposed from    â”‚ â”‚
â”‚ â”‚ monolith to improveâ”‚ â”‚
â”‚ â”‚ scalability        â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                        â”‚
â”‚ ADR Link:              â”‚
â”‚ [ğŸ“„ ADR-005.md]  [Ã—]   â”‚
â”‚ [Open ADR]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Export Dialog Updates

**New Field: Timeline Label**

When exporting, filename includes snapshot label:

**Current:**
```
Export Diagram
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Format: [PNG â–¼]
Filename: Payment_System
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                [Cancel] [Export]
```

**New:**
```
Export Diagram
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Format: [PNG â–¼]
Snapshot: [Before - Monolithic â–¼]
Filename: Payment_System_Before
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â˜ Export all snapshots (Future: v1.1.0)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                [Cancel] [Export]
```

**Features:**
- Snapshot dropdown (select which to export)
- Filename preview updates based on snapshot
- "Export all" checkbox (future: v1.1.0)

---

## ğŸš€ Implementation Phases (6 Weeks)

### Phase 1: Data Model & Services (5 days)

**Goal:** Foundation - file format, services, no UI yet

**Tasks:**
1. Define TypeScript interfaces for timeline data structures
2. Implement TimelineService (create, switch, delete snapshots)
3. Implement AnnotationService (create, update, delete)
4. Implement ChangeDetectionService (detect changes, apply indicators)
5. Update file-io.ts to handle v1.0.0 format (single format only)
6. Unit tests (80%+ coverage on services)

**Deliverables:**
- `types/timeline.ts` - All interfaces
- `services/TimelineService.ts` - Business logic
- `services/AnnotationService.ts` - Business logic
- `services/ChangeDetectionService.ts` - Change detection
- `data/file-io.ts` - Updated for v1.0.0 (simplified)
- `tests/services/timeline-service.test.ts` - 80% coverage

**Acceptance Criteria:**
- Can create/delete/switch snapshots programmatically
- Can detect changes between snapshots
- Can load v1.0.0 files (no backward compatibility needed)
- All service methods have unit tests

**Time Saved from Original Plan:**
- No migration logic (v0.8.0 â†’ v1.0.0)
- No version detection
- Simpler file loading
- **2 days saved** (7 days â†’ 5 days)

---

### Phase 2: Timeline UI (5 days)

**Goal:** Basic timeline navigation (no annotations yet)

**Tasks:**
1. Create TimelineToolbar component
2. Create SnapshotManager modal component
3. Integrate timeline toolbar into canvas-view
4. Hook up snapshot switching (update canvas state)
5. Implement Previous/Next navigation
6. Implement Add Snapshot functionality
7. Implement Delete Snapshot with confirmation
8. Keyboard shortcuts (Cmd+[, Cmd+])

**Deliverables:**
- `ui/components/TimelineToolbar.tsx`
- `ui/components/SnapshotManager.tsx`
- `ui/canvas-view.tsx` (updated)
- `ui/hooks/useTimeline.ts` (custom hook)

**Acceptance Criteria:**
- Timeline toolbar appears when 2+ snapshots exist
- Can create new snapshot from current canvas
- Can switch between snapshots (canvas updates)
- Can navigate with Previous/Next buttons
- Can rename snapshots in SnapshotManager
- Can delete snapshots (with confirmation)
- Keyboard shortcuts work

---

### Phase 3: Change Indicators (5 days)

**Goal:** Visual diff between snapshots

**Tasks:**
1. Update node components to render change badges
2. Implement automatic change detection on snapshot switch
3. Add change indicator property to nodes/edges
4. Style badges (ğŸŸ¢ ğŸŸ¡ ğŸ”´)
5. Update PropertyPanel with Timeline section
6. Allow manual override of change status
7. Implement change note field

**Deliverables:**
- `ui/nodes/SystemNode.tsx` (updated with badge rendering)
- `ui/nodes/ContainerNode.tsx` (updated with badge rendering)
- `ui/components/PropertyPanel.tsx` (Timeline section added)
- `ui/components/ChangeBadge.tsx` (new component)

**Acceptance Criteria:**
- Nodes show change badges when switching snapshots
- Automatic detection works (new, modified, removed)
- Can manually override change status in PropertyPanel
- Badges are visually clear and unobtrusive
- Hover shows change note (if set)

---

### Phase 4: Annotation System (5 days)

**Goal:** Add annotations to explain changes

**Tasks:**
1. Create AnnotationPalette component
2. Create annotation node types (TextBox, Callout, Badge, Highlight)
3. Implement drag-and-drop from palette to canvas
4. Implement annotation property editing
5. Link annotations to specific snapshots (show/hide on switch)
6. Allow linking annotations to nodes
7. Style annotations to match design

**Deliverables:**
- `ui/components/AnnotationPalette.tsx`
- `ui/nodes/TextBoxAnnotation.tsx`
- `ui/nodes/CalloutAnnotation.tsx`
- `ui/nodes/BadgeAnnotation.tsx`
- `ui/nodes/HighlightAnnotation.tsx`
- `ui/hooks/useAnnotations.ts`

**Acceptance Criteria:**
- Annotation palette appears for Context/Container diagrams
- Can drag annotations onto canvas
- Annotations appear/disappear based on current snapshot
- Can edit annotation text, color, position
- Can link annotation to node (follows node movement)
- Annotations included in exports

---

### Phase 5: Export Enhancements (5 days)

**Goal:** Export with timeline labels

**Tasks:**
1. Update export dialog with snapshot selector
2. Implement filename pattern with snapshot label
3. Update useExport hook to include snapshot label
4. Test exports for all formats (PNG, JPEG, SVG)
5. Ensure annotations included in exports
6. Ensure change indicators included in exports

**Deliverables:**
- `ui/hooks/useExport.ts` (updated)
- Export dialog component (updated)

**Acceptance Criteria:**
- Export filename includes snapshot label
- Can select which snapshot to export
- Exported image includes annotations
- Exported image includes change indicators
- All formats work (PNG, JPEG, SVG)

---

### Phase 6: ADR Integration (5 days)

**Goal:** Link diagrams to Architecture Decision Records

**Tasks:**
1. Implement ADRIntegrationService
2. Add "ADR Link" field to node properties
3. Create ADR template generator
4. Implement "Create ADR from Diagram" command
5. Export both Before/After diagrams for ADR
6. Generate change summary text
7. Link node to existing ADR

**Deliverables:**
- `services/ADRIntegrationService.ts`
- `ui/components/PropertyPanel.tsx` (ADR Link field)
- ADR markdown template

**Acceptance Criteria:**
- Can link node to ADR markdown file
- Can create ADR from diagram (Before + After)
- ADR includes both diagram exports
- ADR includes change summary
- Can open linked ADR from PropertyPanel

---

### Phase 7: Testing & Polish (5 days)

**Goal:** Production-ready quality

**Tasks:**
1. Comprehensive manual testing (all workflows)
2. Performance testing (10 snapshots, 50+ nodes)
3. Cross-browser testing (Chrome, Firefox, Safari)
4. Fix bugs found in testing
5. Polish animations and transitions
6. Accessibility review
7. Documentation updates

**Deliverables:**
- Bug fixes
- Performance optimizations
- Polish pass
- Updated documentation

**Acceptance Criteria:**
- All acceptance criteria from previous phases met
- No critical bugs
- Performance targets met (<100ms snapshot switching)
- Documentation complete
- Ready for release

**Time Saved from Original Plan:**
- No backward compatibility testing
- No migration testing
- **1 day saved** (5 days â†’ 4 days) + 1 day buffer

---

### Phase 8 (Optional): Migration Tool (3 days)

**Goal:** One-way converter for users who want to migrate v0.8.0 files

**Status:** Optional - only if users request it after v1.0.0 release

**Tasks:**
1. Create "Import v0.8.0 Diagram" command
2. Parse old format, convert to new format
3. Save as new file (don't overwrite)
4. Show success message with what was converted
5. Test with various v0.8.0 files

**Deliverables:**
- `services/MigrationService.ts` (one-way converter)
- Command in main.ts
- User guide for migration

**Acceptance Criteria:**
- Can load v0.8.0 file via command
- Converts to v1.0.0 with single snapshot
- Creates new file (preserves original)
- Clear success/error messages

**Note:** This phase can be deferred to v1.0.1 or v1.1.0 based on user feedback.

---

## ğŸ§ª Testing Strategy

### Unit Tests (80% Coverage Target)

**Service Layer:**
- `TimelineService.test.ts` - All CRUD operations on snapshots
- `AnnotationService.test.ts` - All annotation operations
- `ChangeDetectionService.test.ts` - Change detection algorithms
- `ADRIntegrationService.test.ts` - ADR generation and linking

**Test Scenarios:**
```typescript
describe('TimelineService', () => {
  it('should create new snapshot with unique ID', () => {});
  it('should copy current canvas state to new snapshot', () => {});
  it('should switch to snapshot and return correct state', () => {});
  it('should delete snapshot and update snapshot order', () => {});
  it('should rename snapshot without changing ID', () => {});
  it('should get next/previous snapshot correctly', () => {});
  it('should handle edge cases (delete last snapshot, etc.)', () => {});
});

describe('ChangeDetectionService', () => {
  it('should detect added nodes between snapshots', () => {});
  it('should detect removed nodes between snapshots', () => {});
  it('should detect modified nodes (label, position, color)', () => {});
  it('should apply change indicators to nodes', () => {});
  it('should generate correct change summary text', () => {});
});
```

### Integration Tests

**Timeline Workflow:**
1. Create new diagram â†’ verify single snapshot
2. Add snapshot â†’ verify two snapshots, timeline toolbar appears
3. Switch snapshots â†’ verify canvas updates
4. Delete snapshot â†’ verify timeline updates
5. Export â†’ verify filename includes snapshot label

**Annotation Workflow:**
1. Add annotation â†’ verify appears on canvas
2. Switch snapshot â†’ verify annotation shows/hides correctly
3. Link annotation to node â†’ verify follows node movement
4. Export â†’ verify annotation included in image

**ADR Workflow:**
1. Create Before/After snapshots
2. Create ADR from diagram
3. Verify ADR markdown includes both exports
4. Verify change summary generated correctly

### Manual Testing Checklist

**Timeline Navigation:**
- [ ] Timeline toolbar appears when 2+ snapshots
- [ ] Previous/Next buttons work
- [ ] Snapshot dropdown shows all snapshots
- [ ] Keyboard shortcuts work (Cmd+[, Cmd+])
- [ ] Add snapshot creates new snapshot
- [ ] Delete snapshot removes and updates order

**Change Indicators:**
- [ ] New nodes show green badge
- [ ] Modified nodes show yellow badge
- [ ] Removed nodes show red badge (semi-transparent)
- [ ] Manual override works in PropertyPanel
- [ ] Hover shows change note

**Annotations:**
- [ ] Annotation palette appears for Context/Container
- [ ] Drag-and-drop creates annotation
- [ ] Annotation properties editable
- [ ] Link to node works (follows movement)
- [ ] Show/hide based on snapshot works
- [ ] Included in exports

**Export:**
- [ ] Filename includes snapshot label
- [ ] Can select snapshot to export
- [ ] Annotations included
- [ ] Change indicators included
- [ ] All formats work (PNG, JPEG, SVG)

**ADR Integration:**
- [ ] Can link node to ADR
- [ ] Can create ADR from diagram
- [ ] ADR includes both exports
- [ ] Change summary generated correctly
- [ ] Open ADR button works

**Performance:**
- [ ] Snapshot switching <100ms
- [ ] Loading 10 snapshots <1s
- [ ] Export with annotations <3s
- [ ] No memory leaks

---

## ğŸ“š Documentation Plan

### User Documentation

**1. README.md Updates**

New section: **"Timeline & Version Tracking"**

```markdown
### Timeline & Version Tracking

**Track architecture evolution over time with timeline snapshots.**

#### Creating Snapshots

1. Create your initial diagram (becomes "Current" snapshot)
2. Click **+ Add Snapshot** to create new timeline state
3. Name it (e.g., "After - Microservices", "Q2 2025", "Target State")
4. Make changes to the diagram (add/remove nodes)
5. Change indicators automatically show what changed

#### Navigating Timeline

- **Previous/Next buttons:** Move between snapshots
- **Snapshot dropdown:** Jump to any snapshot
- **Keyboard shortcuts:** Cmd+[ (previous), Cmd+] (next)

#### Annotations

Explain your changes with visual annotations:
- **Text Box:** Free-form notes
- **Callout:** Arrow pointing to node with explanation
- **Badges:** Mark nodes as New/Modified/Deprecated
- **Highlights:** Draw attention to regions

#### Export with Timeline

Exports include snapshot label in filename:
- `Payment_System_Before.png`
- `Payment_System_After.png`

#### Architecture Decision Records (ADRs)

Link diagrams to ADR markdown files:
1. Create Before/After snapshots
2. Right-click node â†’ "Link to ADR"
3. BAC4 generates ADR template with both diagram exports
4. Change summary automatically included
```

**2. New Guide: `docs/guides/timeline-tracking.md`**

Complete tutorial:
- Step-by-step walkthrough
- Screenshots of each step
- Real-world example (monolith â†’ microservices)
- Best practices

**3. New Guide: `docs/guides/adr-integration.md`**

ADR workflow tutorial:
- What are ADRs?
- How BAC4 enhances ADRs with visual diffs
- Creating ADRs from diagrams
- Linking existing ADRs
- Template customization

### Developer Documentation

**1. CLAUDE.md Updates**

New section: **"Timeline System Architecture"**

```markdown
### Timeline System Architecture (v1.0.0)

The timeline system enables architecture evolution tracking with snapshots, change detection, and annotations.

#### Core Services

**TimelineService:**
- CRUD operations on snapshots
- Navigation (next/previous)
- State management

**AnnotationService:**
- Create/edit/delete annotations
- Link annotations to nodes
- Filter by snapshot

**ChangeDetectionService:**
- Detect changes between snapshots
- Apply visual indicators
- Generate change summaries

**ADRIntegrationService:**
- Link diagrams to ADRs
- Generate ADR templates
- Export Before/After states

#### Data Model

[Detailed explanation of file format]

#### Extension Points

Adding new annotation types:
[Code example with instructions]
```

**2. New Doc: `docs/timeline-technical-spec.md`**

Deep dive into implementation:
- File format specification
- Service layer APIs
- React component architecture
- State management approach

**3. API Reference**

JSDoc for all new services and methods (in code)

---

## ğŸ“Š Success Metrics

### Adoption Metrics

**Target (3 months after v1.0.0 release):**
- 60% of active users create at least 1 multi-snapshot diagram
- 30% of diagrams have 3+ snapshots
- 50% of users use annotations
- 20% of users link diagrams to ADRs

**Measurement:**
- Anonymous usage stats (opt-in)
- GitHub issue feedback
- Community forum discussions

### Quality Metrics

**Technical:**
- 0 critical bugs in first month
- <5 minor bugs in first month
- 80%+ test coverage on new code
- <100ms snapshot switching (p95)

**User Experience:**
- 4.5+ star rating (if on plugin marketplace)
- Positive feedback on GitHub/forums

### Performance Metrics

**Targets:**
- Snapshot switching: <100ms (p95)
- Loading 10 snapshots: <1s (p95)
- Export with annotations: <3s (p95)
- File size increase: <20% per snapshot

**Monitoring:**
- Console.time() measurements in development
- User-reported performance issues
- Large diagram testing (50+ nodes)

---

## ğŸš« Out of Scope (Future Versions)

### v1.1.0 (Future)
- Batch export all snapshots
- Side-by-side comparison view
- Delta/diff storage format (optimization)
- Animation between snapshots (transition effect)
- Timeline branching (multiple futures)

### v2.0.0 (Future)
- Collaboration (real-time multi-user editing)
- Cloud sync
- Version conflict resolution
- Audit trail (who changed what, when)

---

## ğŸ“… Timeline Summary

**Total Estimated Time:** 6 weeks (30 working days)

**Breakdown:**
- Week 1: Data Model & Services (5 days)
- Week 2: Timeline UI (5 days)
- Week 3: Change Indicators (5 days)
- Week 4: Annotation System (5 days)
- Week 5: Export Enhancements (5 days)
- Week 6: ADR Integration (5 days) + Testing & Polish (4 days + 1 buffer)

**Optional:** Week 7: Migration Tool (3 days, if users request)

**Time Saved vs. Original Plan:**
- Phase 1: -2 days (no migration logic)
- Phase 7: -1 day (no compatibility testing)
- **Total: 3 days saved**

---

**Document Status:** âœ… Approved - Ready for Implementation
**Breaking Change:** Yes - v0.8.0 files will NOT work in v1.0.0
**Last Updated:** 2025-10-15
**Next Step:** Begin Phase 1 - Data Model & Services
**Prepared By:** David Oliver + Claude Code
